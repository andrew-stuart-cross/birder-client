<div class="user-profile-container">

    <ng-container *ngIf="(_service.getUserProfile | async) as profile; else loadingOrError">

        <div class="flex-container" data-testid="user-profile">

            <img class="avatar" src="{{profile.user.avatar}}"
                onerror="this.src='https://img.icons8.com/color/96/000000/user.png';" alt="Smiley face" height="126"
                width="126">
            <div>

                <div class="flex-container">
                    <h1 data-testid="h1-user-name">{{ profile.user.userName }}</h1>
                    <app-follow-command [user]="profile.user"></app-follow-command>
                </div>

                <!-- network summary -->
                <p class="summary" data-testid="network-summary"><a routerLink="/followers/{{profile.user.userName}}">{{
                        profile.followersCount }} {{
                        profile.followersCount | followersPlural }}</a>
                    /
                    <a routerLink="/following/{{profile.user.userName}}">{{ profile.followingCount }} following</a>
                </p>

                <!-- observations summary (own profile) -->
                <ng-container *ngIf="profile.user.isOwnProfile">
                    <p class="summary" *ngIf="(_analysisService.count | async) as analysis"
                        data-testid="obs-summary-own">
                        <!-- {{ analysis.uniqueSpeciesCount }} species in {{
                        analysis.totalObservationsCount }}
                        observations -->
                        {{ analysis.uniqueSpeciesCount | observationSummary: analysis.totalObservationsCount }}
                    </p>
                </ng-container>

                <!-- observations summary (other profile) -->
                <ng-container *ngIf="!profile.user.isOwnProfile">
                    <!-- <p class="summary" data-testid="obs-summary-other">{{ profile?.observationCount?.uniqueSpeciesCount
                        }} species in {{
                        profile?.observationCount?.totalObservationsCount }}
                    </p> -->
                    <p class="summary" data-testid="obs-summary-other">
                        {{ profile.observationCount.uniqueSpeciesCount | observationSummary:
                        profile.observationCount.totalObservationsCount }}
                    </p>
                </ng-container>

                <p class="register-large summary">Joined on {{ profile.registrationDate | date: 'EEEE, d MMMM yyyy'}}
                </p>

                <p class="register-small summary">Joined on {{ profile.registrationDate | date: 'dd/MM/yy'}}</p>

            </div>
        </div>

        <hr>

        <ul ngbNav #nav="ngbNav" class="nav-tabs">
            <li [ngbNavItem]="1">
                <a ngbNavLink>Observations</a>
                <ng-template ngbNavContent>
                    <!-- Keep content! -->
                    <!-- <app-user-feed></app-user-feed> -->
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus at cursus est, vel
                        scelerisque
                        metus. Fusce eu egestas dolor. Suspendisse efficitur odio urna, vitae commodo ante lacinia
                        at.
                        In a aliquam turpis. Suspendisse ac justo at arcu tristique efficitur. Morbi sit amet magna
                        sit
                        amet est rhoncus pretium. Suspendisse ac placerat nisl, eget malesuada dui. Praesent
                        pulvinar
                        volutpat enim ac imperdiet. Ut in hendrerit nisi, at fringilla turpis. Aliquam pharetra,
                        odio id
                        rhoncus condimentum, arcu neque posuere mi, vitae iaculis odio massa non enim. Donec quis
                        tempus
                        libero, a egestas est. Proin non felis ut massa dictum aliquam a eget ante. Quisque
                        consectetur
                        sapien malesuada mauris tristique, eget porttitor lectus porttitor. Fusce in laoreet massa.
                        Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis
                        egestas.
                        Nullam in ipsum blandit, malesuada velit eget, bibendum purus.</p>
                </ng-template>
            </li>
            <li [ngbNavItem]="2">
                <a ngbNavLink>Distribution map</a>
                <ng-template ngbNavContent>
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus at cursus est, vel
                        scelerisque
                        metus. Fusce eu egestas dolor. Suspendisse efficitur odio urna, vitae commodo ante lacinia
                        at.
                        In a aliquam turpis. Suspendisse ac justo at arcu tristique efficitur. Morbi sit amet magna
                        sit
                        amet est rhoncus pretium. Suspendisse ac placerat nisl, eget malesuada dui. Praesent
                        pulvinar
                        volutpat enim ac imperdiet. Ut in hendrerit nisi, at fringilla turpis. Aliquam pharetra,
                        odio id
                        rhoncus condimentum, arcu neque posuere mi, vitae iaculis odio massa non enim. Donec quis
                        tempus
                        libero, a egestas est. Proin non felis ut massa dictum aliquam a eget ante. Quisque
                        consectetur
                        sapien malesuada mauris tristique, eget porttitor lectus porttitor. Fusce in laoreet massa.
                        Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis
                        egestas.
                        Nullam in ipsum blandit, malesuada velit eget, bibendum purus.</p>
                </ng-template>
            </li>
            <li [ngbNavItem]="3">
                <a ngbNavLink>Achievements</a>
                <ng-template ngbNavContent>
                    <p>Sed commodo, leo at suscipit dictum, quam est porttitor sapien, eget sodales nibh elit id
                        diam.
                        Nulla facilisi.
                        Donec egestas ligula vitae odio interdum aliquet. Duis lectus turpis, luctus eget tincidunt
                        eu,
                        congue et odio.
                        Duis pharetra et nisl at faucibus. Quisque luctus pulvinar arcu, et molestie lectus ultrices
                        et.
                        Sed diam urna,
                        egestas ut ipsum vel, volutpat volutpat neque. Praesent fringilla tortor arcu. Vivamus
                        faucibus
                        nisl enim, nec
                        tristique ipsum euismod facilisis. Morbi ut bibendum est, eu tincidunt odio. Orci varius
                        natoque
                        penatibus et
                        magnis dis parturient montes, nascetur ridiculus mus. Mauris aliquet odio ac lorem aliquet
                        ultricies in eget
                        neque. Phasellus nec tortor vel tellus pulvinar feugiat.</p>
                </ng-template>
            </li>
        </ul>

        <div [ngbNavOutlet]="nav" class="mt-2"></div>

    </ng-container>


    <ng-template #loadingOrError>
        <div *ngIf="(_service.isError | async); else loading" class="alert alert-danger" data-testid="error">
            <strong>Whoops!</strong> There was an error retrieving the data.<br>
            <button type="button" class="btn btn-primary btn-sm btn-try-again" data-testid="reload-button"
                (click)="reload()">Try
                Again</button>
        </div>
    </ng-template>


    <ng-template #loading>
        <app-loading></app-loading>
    </ng-template>

</div>